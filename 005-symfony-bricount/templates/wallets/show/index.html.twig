{% extends '_layouts/in_app.html.twig' %}

{% block title %}Détail {{ wallet.label }} | +Count {% endblock %}

{% block content %}
    {# --- EN-TÊTE DU PORTEFEUILLE --- #}
    <div class="section-header">
        <div>
            <a href="{{ path('wallets_list') }}" class="btn-back">
                <i class="fa-solid fa-arrow-left"></i> Retour
            </a>
            <h1 class="page-title" style="margin-top:10px;">{{ wallet.label }}</h1>
        </div>

        <div style="display: flex; gap: 10px;">

            {# S'il est pas admin, ne pas afficher le btn de modif tout simplement #}
            {% if userAccess and userAccess.role == 'admin' %}
                {# Bouton Modifier (icône d'engrenage ou crayon) #}
                <a href="{{ path('wallets_edit', {uid: wallet.uid}) }}" class="btn-modern"
                   style="background: white; color: var(--text-dark); border: 1px solid #e2e8f0; width: auto; padding: 10px 15px;">
                    <i class="fa-solid fa-pen"></i>
                </a>

                {# NOUVEAU : Bouton Ajouter un membre #}
                <a href="{{ path('wallets_add_user', {uid: wallet.uid}) }}"
                   class="btn-modern"
                   title="Ajouter un membre"
                   style="background: white; color: var(--main-color); border: 1px solid var(--main-color); width: auto; padding: 10px 15px;">
                    <i class="fa-solid fa-user-plus"></i>
                </a>

            {% endif %}


            {# Bouton Nouvelle dépense #}
            <a href="#" class="btn-modern" style="width: auto; padding: 10px 25px;">
                <i class="fa-solid fa-plus"></i> Nouvelle dépense
            </a>
        </div>
    </div>

    {# --- CARTE SOLDE  --- #}
    <div class="wallet-detail-header">
        <div>
            <div class="wallet-total-label">Solde Actuel</div>
            <div class="wallet-total-amount">{{ (wallet.totalAmount/100)|number_format(2, ',', ' ') }} €</div>
        </div>

        <div style="text-align: right;">
            <div class="t-meta">Page actuelle</div>
            <div style="font-weight:600; color:var(--text-dark); font-size: 1.2rem;">{{ currentPage }}
                / {{ (totalPages > 1) ? totalPages : 1 }}</div>
            {# petit détail pour éviter le 1/0 pages quand on génère pas la pagination #}
        </div>
    </div>

    {# --- LISTE DES DÉPENSES --- #}
    <div class="transaction-container">
        {% for expense in expenses %}
            <div class="transaction-card">
                {# 1. ICONE #}
                <div class="t-icon-box">
                    <i class="fa-solid fa-bag-shopping"></i>
                </div>

                {# 2. INFOS #}
                <div class="t-details">
                    {# Le filtre |default gère le cas où la description est vide (nullable) #}
                    <span class="t-label">{{ expense.description|default('Dépense sans nom') }}</span>

                    <span class="t-meta">
                        {{ expense.createdDate|date('d M Y') }} à {{ expense.createdDate|date('H:i') }}
                    </span>
                </div>

                {# 3. MONTANT #}
                {% set isPositive = expense.amount > 0 %}
                <div class="t-amount {{ isPositive ? 'amount-positive' : 'amount-negative' }}">
                    {{ isPositive ? '+' : '' }}{{ (expense.amount / 100)|number_format(2, ',', ' ') }} €
                </div>

                {# 4. ACTIONS #}
                <div style="margin-left: 20px; font-size:1.3rem; ">
                    <a href="#" style="color: #a0aec0;" title="Actions sur les dépenses."><i
                            class="fa-solid fa-ellipsis-vertical"></i></a>
                </div>
            </div>
        {% else %}
            {# ETAT VIDE #}
            <div style="text-align: center; padding: 50px; color: #a0aec0;">
                <i class="fa-solid fa-ghost" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.3;"></i>
                <p>Aucune dépense sur cette page.</p>
            </div>
        {% endfor %}
    </div>

    {# --- PAGINATION MANUELLE --- #}
    {% if totalPages > 1 %}
        <div class="pagination-wrapper">
            <ul class="pagination">
                {# BOUTON PRECEDENT #}
                <li class="page-item {{ currentPage == 1 ? 'disabled' }}">
                    <a href="{{ path('wallets_show', {uid: wallet.uid, page: currentPage - 1}) }}" class="page-link">
                        <i class="fa-solid fa-chevron-left"></i>
                    </a>
                </li>

                {# NUMEROS DE PAGE #}
                {# On affiche toutes les pages. Si tu en as 100, il faudra faire une logique plus complexe plus tard #}
                {% for i in 1..totalPages %}
                    <li class="page-item {{ currentPage == i ? 'active' }}">
                        <a href="{{ path('wallets_show', {uid: wallet.uid, page: i}) }}" class="page-link">
                            {{ i }}
                        </a>
                    </li>
                {% endfor %}

                {# BOUTON SUIVANT #}
                <li class="page-item {{ currentPage == totalPages ? 'disabled' }}">
                    <a href="{{ path('wallets_show', {uid: wallet.uid, page: currentPage + 1}) }}" class="page-link">
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </li>
            </ul>
        </div>
    {% endif %}

{% endblock %}
